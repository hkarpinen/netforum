@page "{username}"
@using NETForum.Constants
@using NETForum.Helpers
@using NETForum.Pages.Shared.Components.UserPhoto
@model NETForum.Pages.Members.ViewModel

@{
    ViewData["Title"] = "Member - " + Model.UserPageDto.Username;
}

<div class="row">
    <div class="col">
        <div class="card">
            <div class="card-body">
                <ul class="nav nav-tabs" id="userTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button
                            class="nav-link text-secondary active"
                            id="posts-tab"
                            data-bs-toggle="tab"
                            data-bs-target="#posts"
                            type="button"
                            role="tab"
                            aria-controls="posts"
                            aria-selected="true"
                        >
                            Posts
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button
                            class="nav-link text-secondary"
                            id="replies-tab"
                            data-bs-toggle="tab"
                            data-bs-target="#replies"
                            type="button"
                            role="tab"
                            aria-controls="replies"
                            aria-selected="false"
                        >
                            Replies
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button
                            class="nav-link text-secondary"
                            id="about-tab"
                            data-bs-toggle="tab"
                            data-bs-target="#about"
                            type="button"
                            role="tab"
                            aria-controls="about"
                            aria-selected="false"
                        >
                            About
                        </button>
                    </li>
                </ul>
                <div class="mt-3 tab-content" id="userTabsContent">
                    <div class="tab-pane fade show active" id="posts" role="tabpanel" aria-labelledby="posts-tab">
                        @if (Model.UserPageDto.Posts.Any())
                        {
                            @for (var i = 0; i < Model.UserPageDto.Posts.Count; i++)
                            {
                                var post = Model.UserPageDto.Posts[i];
                                var lastItem = i == Model.UserPageDto.Posts.Count - 1;
                                
                                <div class="post-item @(lastItem ? "" : "border-bottom")">
                                    <div class="d-flex gap-2 post-list-item mt-2">
                                        <div class="post-avatar-block">
                                            <span class="text-secondary">
                                                @await Component.InvokeAsync("UserPhoto", new UserPhotoViewModel()
                                                {
                                                    PhotoUrl = post.AuthorAvatarUrl,
                                                    UserName = post.AuthorName,
                                                })
                                            </span>
                                        </div>
                                        <div class="d-flex flex-column post-details-block">
                                            <a
                                                class="d-flex flex-column text-decoration-none link-secondary"
                                                asp-page="@PageRoutes.PostView"
                                                asp-route-id="@post.Id">
                                                <p class="m-0 post-title">@post.Title</p>
                                            </a>
                                            <small class="m-0 post-content">@HtmlHelpers.StripAndTruncateHtml(post.Content, 100)</small>
                                            <small>@DateHelpers.ToRelativeDatetimeString(post.CreatedAt)</small>
                                        </div>
                                    </div>
                                </div>
                            } 
                        }
                    </div>
                    <div class="tab-pane fade" id="replies" role="tabpanel" aria-labelledby="replies-tab">
                        @if (Model.UserPageDto.Replies.Any())
                        {
                            @for (var i = 0; i < Model.UserPageDto.Replies.Count; i++)
                            {
                                var reply = Model.UserPageDto.Replies[i];
                                var lastItem = i == Model.UserPageDto.Replies.Count - 1;
                                
                                <div class="reply-item @(lastItem ? "" : "border-bottom")">
                                    <div class="d-flex justify-content-between p-1">
                                        <div class="d-flex gap-3 align-items-center">
                                            <span class="text-secondary"> 
                                                @await Component.InvokeAsync("UserPhoto", new UserPhotoViewModel()
                                                {
                                                    PhotoUrl = reply.AuthorAvatarImageUrl,
                                                    UserName = reply.AuthorName,
                                                })
                                            </span>
                                            <!-- Need to use anchor links for these replies. On Post Page load if the temp data has the reply id then we navigate to the reply with javascript. -->
                                            <a 
                                                class="d-flex flex-column text-decoration-none text-black"
                                                asp-page="/Posts/Details"
                                                asp-route-id="@reply.Id"
                                            >
                                                       <small class="m-0 post-content">@HtmlHelpers.StripAndTruncateHtml(reply.Content, 100)</small>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            }  
                        }
                    </div>
                    <div class="tab-pane fade" id="about" role="tabpanel" aria-labelledby="about-tab">
                        <p>About</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>