@using NETForum.Models.Components
@model UserProfileViewModel

@{
    string GetInitials(string name)
    {
        if (string.IsNullOrWhiteSpace(name)) return "U";
        var parts = name.Split(' ', StringSplitOptions.RemoveEmptyEntries);
        if (parts.Length == 1) return parts[0][0].ToString().ToUpper();
        return $"{parts[0][0]}{parts[^1][0]}".ToUpper();
    }

    var initials = GetInitials(Model.DisplayName);
    var roles = Model.RoleNames?.ToList() ?? new List<string>();
    var isAdmin = roles.Contains("Admin");
    var isModerator = roles.Contains("Moderator");
}

<div class="dropdown">
    <button class="btn btn-link p-0" type="button" data-bs-toggle="dropdown" aria-expanded="false">
        @if (!string.IsNullOrEmpty(Model.ProfilePhotoUrl))
        {
            <img src="@Model.ProfilePhotoUrl" alt="@Model.DisplayName" class="rounded-circle" width="40" height="40" />
        }
        else
        {
            <div class="bg-secondary text-white rounded-circle d-flex align-items-center justify-content-center" 
                style="width: 40px; height: 40px; background: white;"
            >
                <small class="fw-bold">@initials</small>
            </div>
        }
    </button>

    <ul class="dropdown-menu dropdown-menu-end">
        <li class="dropdown-header">
            <div class="fw-semibold">@Model.DisplayName</div>
            <small class="text-muted">@Model.Email</small>
            @if (roles.Any())
            {
                <div class="mt-1">
                    @foreach (var role in roles)
                    {
                        <span class="badge bg-primary me-1">@role</span>
                    }
                </div>
            }
        </li>
        <li><hr class="dropdown-divider"></li>

        <li>
            <a class="dropdown-item" asp-page="/Account/Profile/Edit">
                <i class="fas fa-user-edit me-2"></i>Edit Profile
            </a>
        </li>

        @if (isAdmin)
        {
            <li>
                <a class="dropdown-item" asp-page="/Admin/Index">
                    <i class="fas fa-shield-alt me-2"></i>Admin Panel
                </a>
            </li>
        }

        @if (isModerator || isAdmin)
        {
            <li>
                <a class="dropdown-item" asp-page="/Moderation/Index">
                    <i class="fas fa-user-shield me-2"></i>Moderation
                </a>
            </li>
        }

        <li>
            <a class="dropdown-item" asp-page="/Account/Settings">
                <i class="fas fa-cog me-2"></i>Settings
            </a>
        </li>

        <li><hr class="dropdown-divider"></li>

        <li>
            <a asp-page="/Account/Logout/Index" class="d-inline w-100">
                <i class="fas fa-sign-out-alt me-2"></i>Logout
            </a>
        </li>
    </ul>
</div>